using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;
using System.IO.Compression;
using System.Text;

namespace ApiForTestOHIF.Controllers
{
    public class StudiesController : ControllerBase
    {
        [Route("aets/{AeTitle}/rs/studies")]
        [HttpGet]
        public ActionResult SearchForStudies([FromQuery] int limit, [FromQuery] int offset)
        {
            // string json =  @"[{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19600116""]},""00080030"":{""vr"":""TM"",""Value"":[""082433.00""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""WB PET/CT""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.871108593056125491804754960339""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.871108593056125491804754960339""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""4""]},""00201208"":{""vr"":""IS"",""Value"":[""934""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20091229""]},""00080030"":{""vr"":""TM"",""Value"":[""095915""]},""00080050"":{""vr"":""SH"",""Value"":[""S07-100""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN"",""Value"":[{}]},""00080201"":{""vr"":""SH"",""Value"":[""-0500""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.29.0""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DupaBlada^AperioCMU-1""}]},""00100020"":{""vr"":""LO"",""Value"":[""PX7832548325932""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.29.0""]},""00200010"":{""vr"":""SH"",""Value"":[""S07-100""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20140930""]},""00080030"":{""vr"":""TM"",""Value"":[""101151.000""]},""00080050"":{""vr"":""SH"",""Value"":[""000041579""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""DFCI CT CHEST W CONTRAST 6023""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170125095722.1""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Neptune""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000002""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""F""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170125095722.1""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""6""]},""00201208"":{""vr"":""IS"",""Value"":[""609""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20141212""]},""00080030"":{""vr"":""TM"",""Value"":[""092205.578000""]},""00080050"":{""vr"":""SH"",""Value"":[""0000155811""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""PETCT""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170125113417.1""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Juno""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000003""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170125113417.1""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""6""]},""00201208"":{""vr"":""IS"",""Value"":[""918""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA""},""00080030"":{""vr"":""TM""},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""MG""]},""00080090"":{""vr"":""PN""},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.9590.100.1.2.85935434310203356712688695661986996009""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""P_00038^P_00038""}]},""00100020"":{""vr"":""LO"",""Value"":[""P_00038_LEFT_CC.dcm""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.9590.100.1.2.85935434310203356712688695661986996009""]},""00200010"":{""vr"":""SH"",""Value"":[""DDSM""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20090224""]},""00080030"":{""vr"":""TM"",""Value"":[""071410""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""CT CHEST W CONTRAST""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.3098.5025.109166066136618523367625484576""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""PD-1-Lung-00013""}]},""00100020"":{""vr"":""LO"",""Value"":[""PD-1-Lung-00013""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.3098.5025.109166066136618523367625484576""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""147""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20140325""]},""00080030"":{""vr"":""TM"",""Value"":[""152924.000""]},""00080050"":{""vr"":""SH"",""Value"":[""000041571""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""DFCI CT CHEST W CONTRAST 6023""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170125095258.1""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Neptune""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000002""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""F""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170125095258.1""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""5""]},""00201208"":{""vr"":""IS"",""Value"":[""249""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20140522""]},""00080030"":{""vr"":""TM"",""Value"":[""095411.000""]},""00080050"":{""vr"":""SH"",""Value"":[""000041576""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""DFCI CT CHEST W CONTRAST 6023""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170125095438.5""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Neptune""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000002""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""F""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170125095438.5""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""5""]},""00201208"":{""vr"":""IS"",""Value"":[""381""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20180227""]},""00080030"":{""vr"":""TM"",""Value"":[""094600""]},""00080050"":{""vr"":""SH"",""Value"":[""2017092101""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN""},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.2.392.200140.2.1.1.1.2.799008771.2156.1519721160.421""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""PID_666""}]},""00100020"":{""vr"":""LO"",""Value"":[""PID_666""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.2.392.200140.2.1.1.1.2.799008771.2156.1519721160.421""]},""00200010"":{""vr"":""SH"",""Value"":[""SID_9999""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""15""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20180227""]},""00080030"":{""vr"":""TM"",""Value"":[""095339""]},""00080050"":{""vr"":""SH"",""Value"":[""2015031201""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN""},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.2.392.200140.2.1.1.1.2.799008771.4064.1519721619.405""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""PID_47110815""}]},""00100020"":{""vr"":""LO"",""Value"":[""PID_47110815""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.2.392.200140.2.1.1.1.2.799008771.4064.1519721619.405""]},""00200010"":{""vr"":""SH"",""Value"":[""SID_1""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""7""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19600116""]},""00080030"":{""vr"":""TM"",""Value"":[""095640.00""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""LUNG DELAYS""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.334240657131972136850343327463""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.334240657131972136850343327463""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""4""]},""00201208"":{""vr"":""IS"",""Value"":[""406""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19600910""]},""00080030"":{""vr"":""TM"",""Value"":[""091340""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""CT THORAX ENHANCED""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.194158539675615867024676990849""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.194158539675615867024676990849""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""4""]},""00201208"":{""vr"":""IS"",""Value"":[""138""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19600624""]},""00080030"":{""vr"":""TM"",""Value"":[""122019.00""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""WB PET/CT""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.459769504433903221904322299373""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.459769504433903221904322299373""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""4""]},""00201208"":{""vr"":""IS"",""Value"":[""930""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19591213""]},""00080030"":{""vr"":""TM"",""Value"":[""093056""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""CT THORAX ENHANCE""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.300468367115324750799216325524""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.300468367115324750799216325524""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""3""]},""00201208"":{""vr"":""IS"",""Value"":[""76""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20091229""]},""00080030"":{""vr"":""TM"",""Value"":[""095915""]},""00080050"":{""vr"":""SH"",""Value"":[""S07-100""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN"",""Value"":[{}]},""00080201"":{""vr"":""SH"",""Value"":[""-0500""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.21.0""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DupaBlada^AperioCMU-1""}]},""00100020"":{""vr"":""LO"",""Value"":[""PX7832548325932""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.21.0""]},""00200010"":{""vr"":""SH"",""Value"":[""S07-100""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20091229""]},""00080030"":{""vr"":""TM"",""Value"":[""095915""]},""00080050"":{""vr"":""SH"",""Value"":[""S07-100""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN"",""Value"":[{}]},""00080201"":{""vr"":""SH"",""Value"":[""-0500""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.5.0""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DupaBlada^AperioCMU-1""}]},""00100020"":{""vr"":""LO"",""Value"":[""PX7832548325932""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.5.0""]},""00200010"":{""vr"":""SH"",""Value"":[""S07-100""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20091229""]},""00080030"":{""vr"":""TM"",""Value"":[""095915""]},""00080050"":{""vr"":""SH"",""Value"":[""S07-100""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN"",""Value"":[{}]},""00080201"":{""vr"":""SH"",""Value"":[""-0500""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.13.0""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DupaBlada^AperioCMU-1""}]},""00100020"":{""vr"":""LO"",""Value"":[""PX7832548325932""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.13.0""]},""00200010"":{""vr"":""SH"",""Value"":[""S07-100""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20111020""]},""00080030"":{""vr"":""TM"",""Value"":[""093706.750000""]},""00080050"":{""vr"":""SH"",""Value"":[""1159134546898715""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""MR""]},""00081030"":{""vr"":""LO"",""Value"":[""MR prostaat kanker detectie WDS_mc MCAPRODETW""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7311.5101.247316591887822227457894627822""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""ProstateX-0005""}]},""00100020"":{""vr"":""LO"",""Value"":[""ProstateX-0005""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7311.5101.247316591887822227457894627822""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""3""]},""00201208"":{""vr"":""IS"",""Value"":[""53""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20100510""]},""00080030"":{""vr"":""TM"",""Value"":[""133352.906000""]},""00080050"":{""vr"":""SH"",""Value"":[""00000001""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""Neck^HeadNeckPETCT""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.52237031786.3872.20100510032220.1""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Patient^Anonymous""}]},""00100020"":{""vr"":""LO"",""Value"":[""12345678""]},""00100030"":{""vr"":""DA"",""Value"":[""19560324""]},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.52237031786.3872.20100510032220.1""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""5""]}},{""00080020"":{""vr"":""DA"",""Value"":[""20091229""]},""00080030"":{""vr"":""TM"",""Value"":[""095915""]},""00080050"":{""vr"":""SH"",""Value"":[""S07-100""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""SM""]},""00080090"":{""vr"":""PN"",""Value"":[{}]},""00080201"":{""vr"":""SH"",""Value"":[""-0500""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.37.0""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DupaBlada^AperioCMU-1""}]},""00100020"":{""vr"":""LO"",""Value"":[""PX7832548325932""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS""},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.5962.99.1.3827483890.1961511620.1550015743218.37.0""]},""00200010"":{""vr"":""SH"",""Value"":[""S07-100""]},""00201206"":{""vr"":""IS"",""Value"":[""1""]},""00201208"":{""vr"":""IS"",""Value"":[""1""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20140805""]},""00080030"":{""vr"":""TM"",""Value"":[""121956.906000""]},""00080050"":{""vr"":""SH"",""Value"":[""000015587""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""PETCT""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170125112931.11""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Juno""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000003""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170125112931.11""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""5""]},""00201208"":{""vr"":""IS"",""Value"":[""921""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""19600624""]},""00080030"":{""vr"":""TM"",""Value"":[""133447.00""]},""00080050"":{""vr"":""SH""},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT"",""PT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""LUNG DELAYS""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.14519.5.2.1.7009.2403.129940714907926843330943219641""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""DUPADUPANSCLC-FDG-PET-042""}]},""00100020"":{""vr"":""LO"",""Value"":[""DUPADUPANSCLC-FDG-PET-042""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""M""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.129940714907926843330943219641""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""4""]},""00201208"":{""vr"":""IS"",""Value"":[""406""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080020"":{""vr"":""DA"",""Value"":[""20150224""]},""00080030"":{""vr"":""TM"",""Value"":[""093837.000""]},""00080050"":{""vr"":""SH"",""Value"":[""0000922113""]},""00080054"":{""vr"":""AE"",""Value"":[""DCM4CHEE""]},""00080056"":{""vr"":""CS"",""Value"":[""ONLINE""]},""00080061"":{""vr"":""CS"",""Value"":[""CT""]},""00080090"":{""vr"":""PN""},""00081030"":{""vr"":""LO"",""Value"":[""DFCI CT CHEST W CONTRAST 6023""]},""00081190"":{""vr"":""UR"",""Value"":[""http://server.dcmjs.org/dcm4chee-arc/aets/DCM4CHEE/rs/studies/1.3.6.1.4.1.25403.345050719074.3824.20170126083429.2""]},""00100010"":{""vr"":""PN"",""Value"":[{""Alphabetic"":""Venus""}]},""00100020"":{""vr"":""LO"",""Value"":[""0000005""]},""00100030"":{""vr"":""DA""},""00100040"":{""vr"":""CS"",""Value"":[""F""]},""0020000D"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.25403.345050719074.3824.20170126083429.2""]},""00200010"":{""vr"":""SH""},""00201206"":{""vr"":""IS"",""Value"":[""3""]},""00201208"":{""vr"":""IS"",""Value"":[""381""]}}]";
            //
            string json = @"[{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080008"":{""vr"":""CS"",""Value"":[""ORIGINAL"",""PRIMARY""]},""00080012"":{""vr"":""DA"",""Value"":[""19600116""]},""00080013"":{""vr"":""TM"",""Value"":[""083156.000""]},""00080014"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.121957164877324988509673901373""]}},{""00080005"":{""vr"":""CS"",""Value"":[""ISO_IR 100""]},""00080008"":{""vr"":""CS"",""Value"":[""ORIGINAL"",""PRIMARY""]},""00080012"":{""vr"":""DA"",""Value"":[""19600116""]},""00080013"":{""vr"":""TM"",""Value"":[""083156.000""]},""00080014"":{""vr"":""UI"",""Value"":[""1.3.6.1.4.1.14519.5.2.1.7009.2403.121957164877324988509673901373""]}}]";
            //HttpContext.Response.Headers.Add("Transfer-Encoding", "chunked");
            //HttpContext.Response.Headers.Add("Connection", "keep-alive");
            HttpContext.Response.Headers.Add("Vary", "Accept-Encoding");
            //HttpContext.Response.Headers.Add("Cache-Control", "no-cache");
            //HttpContext.Response.Headers.Add("Access-Control-Allow-Headers", "origin, content-type, accept, authorization");
            //HttpContext.Response.Headers.Add("Access-Control-Allow-Origin", "*");
            //HttpContext.Response.Headers.Add("Access-Control-Allow-Credentials", "true");
            //HttpContext.Response.Headers.Add("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS, HEAD");
            //HttpContext.Response.Headers.Add("Strict-Transport-Security", "max-age=15724800; includeSubDomains");
            //HttpContext.Response.Headers.Add("Accept-Encoding", "");
            //HttpContext.Response.Headers.Add("Content-Encoding", "gzip");
            HttpContext.Response.ContentType = "application/dicom+json";
            //HttpContext.Response.ContentLength = json.Length;
            return Ok(json);
            //return Ok(Compress(json)); //Kompresja string do GZIP
        }

        private static byte[] Compress(string s)
        {
            var b = Encoding.UTF8.GetBytes(s);
            var ms = new MemoryStream();
            using (GZipStream zipStream = new GZipStream(ms, CompressionMode.Compress))
            {
                zipStream.Write(b, 0, b.Length);
                zipStream.Flush();
            }
            var data = ms.ToArray();
            ms.Dispose();
            return data;
        }
    }
}
